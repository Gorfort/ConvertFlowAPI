<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Currency Converter</title>
  </head>
  <body>
    <h1>Currency Converter</h1>

    <label for="amount">Amount:</label>
    <input type="number" id="amount" placeholder="Enter amount" />

    <label for="from">From:</label>
    <select id="from"></select>

    <label for="to">To:</label>
    <select id="to"></select>

    <button onclick="convert()">Convert</button>

    <p id="result"></p>

    <script>
      // Function to populate currency dropdowns
      function populateCurrencies() {
        fetch("http://localhost:3000/currencies")
          .then((response) => response.json())
          .then((data) => {
            const fromCurrencySelect = document.getElementById("from");
            const toCurrencySelect = document.getElementById("to");

            // Clear existing options
            fromCurrencySelect.innerHTML = "";
            toCurrencySelect.innerHTML = "";

            // Add default option
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.text = "Select Currency";
            fromCurrencySelect.add(defaultOption);
            toCurrencySelect.add(defaultOption.cloneNode(true));

            // Add currency options
            data.forEach((currency) => {
              const option = document.createElement("option");
              option.value = currency;
              option.text = currency;

              fromCurrencySelect.add(option);
              toCurrencySelect.add(option.cloneNode(true));
            });
          })
          .catch((error) => console.error("Error fetching currencies:", error));
      }

      // Function to perform currency conversion
      function convert() {
        const amount = document.getElementById("amount").value;
        const fromCurrency = document.getElementById("from").value;
        const toCurrency = document.getElementById("to").value;

        fetch(
          `http://localhost:3000/convert?amount=${amount}&from=${fromCurrency}&to=${toCurrency}`
        )
          .then((response) => response.json())
          .then((data) => {
            document.getElementById(
              "result"
            ).innerText = `${amount} ${fromCurrency} = ${data.convertedAmount} ${toCurrency}`;
          })
          .catch((error) =>
            console.error("Error converting currencies:", error)
          );
      }

      // Populate currencies when the page loads
      window.onload = function () {
        populateCurrencies();
      };
    </script>
  </body>
</html>
